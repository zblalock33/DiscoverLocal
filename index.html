<!DOCTYPE html>
<html>
<head>
  <!-- meta for the browser to allow for mobile first design -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

  <title>Discover Local</title>

  <style>
    html,
    body,
    #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
    }

    .app-title {
        position: fixed;
        z-index: 10;
        top: 0;
        left: 0;
        width: 100%;
        color: #FFFFFF;
        background-color: #8B0000;
        padding: 8px 0;
        font-size: 18px;
        text-align: center;
        box-sizing: border-box;
    }

    .addRecordBtn,
    .toggle-search-btn {
        position: fixed;
        z-index: 10;
        bottom: 10px;
        background-color: #8B0000;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
        text-decoration: none;
        box-sizing: border-box;
    }

    .addRecordBtn {
        right: 10px;
    }

    .toggle-search-btn {
        left: 10px;
    }

    .addRecordBtn:hover,
    .toggle-search-btn:hover {
        background-color: #640000;
    }

    #searchWidgetDiv {
        display: none;
        position: fixed;
        z-index: 10;
        top: 60px;
        left: 0;
        right: 0;
        padding: 0 10px;
        box-sizing: border-box;
    }

    .esri-search .esri-search__container {
        background-color: #8B0000 !important;
        color: black !important;
    }

    .esri-search .esri-input {
        color: black !important;
    }

    .esri-search .esri-button {
        background-color: #8B0000 !important;
        color: black !important;
    }

    /* Embed Survey123 form styles */
    .embed-container {
        position: relative;
        height: 0;
        padding-bottom: 80%;
        max-width: 100%;
    }
    .embed-container iframe, .embed-container object, .embed-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
    }
    small {
        position: absolute;
        z-index: 40;
        bottom: 0;
        margin-bottom: -15px;
    }
  </style>

  <!--importing the css and libraries for esri.js-->
  <link rel="stylesheet" href="https://js.arcgis.com/4.29/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.29/"></script>

  <!--loading the modules-->
  <script>
    require([
      "esri/config", 
      "esri/Map", 
      "esri/views/MapView", 
      "esri/widgets/Locate", 
      "esri/widgets/Search",
      "esri/layers/FeatureLayer",
      "esri/renderers/UniqueValueRenderer",
      "esri/symbols/SimpleMarkerSymbol"
    ], (esriConfig, Map, MapView, Locate, Search, FeatureLayer, UniqueValueRenderer, SimpleMarkerSymbol) => {
  

        esriConfig.apiKey = "YAAPK35e8e98d277843dfa2ecdb1ac5596534DUB-IUl6Q31xNVu54SYAcGis0XVil_5jLFCe1-ROFe_wjMpb0UxI4IkOSh_Cgjl3";

        const map = new Map({
              basemap: "satellite"
        });

        const view = new MapView({
              container: "viewDiv",
              map: map,
              center: [-98.5795, 39.8283],
              zoom: 3,
              ui: {
                components: ["attribution"]
              }
        });

        const locateBtn= new Locate({
            view : view
        });

        // Define a renderer for the venue types
        const venueTypeRenderer = new UniqueValueRenderer({
          field: "venue_type",
          uniqueValueInfos: [
            {
              value: "Bar",
              symbol: new SimpleMarkerSymbol({
                color: "red",
                size: "20px",
                outline: { color: "white" }
              }),
              label: "Bar"
            },
            {
              value: "Restaurant",
              symbol: new SimpleMarkerSymbol({
                color: "green",
                size: "20px",
                outline: { color: "white" }
              }),
              label: "Restaurant"
            },
            {
              value: "Arcade",
              symbol: new SimpleMarkerSymbol({
                color: "blue",
                size: "20px",
                outline: { color: "white" }
              }),
              label: "Arcade"
            }
            // Add more venue types as needed
          ]
        });

        const layer= new FeatureLayer({
            url: "https://services.arcgis.com/LBbVDC0hKPAnLRpO/arcgis/rest/services/survey123_16f8e266ef6b421fb8c2537c5941b2f9_results/FeatureServer",
            renderer: venueTypeRenderer // Use the renderer for the layer
        });

        view.ui.add (locateBtn, {
            position: "top-left"
        });

        const searchWidget = new Search({
            view: view,
            container: "searchWidgetDiv",
            popupEnabled: true,
            popupOpenOnSelect: true,
            resultGraphicEnabled: true,
            autoSelect: true
        });

        map.add(layer);

  });

  </script>
</head>

<body>
    <header class="app-title">DiscoverLocal</header>
    <!-- Changed to a button to prevent redirection -->
    <button class="addRecordBtn" id="addRecord">Add Record</button>
    <button id="toggleSearch" class="toggle-search-btn">Search</button>
    <div id="searchWidgetDiv"></div>
    <div id="viewDiv"></div>
  
    <!-- Embed Survey123 form -->
    <div class="embed-container" id="surveyContainer" style="display:none;">
      <iframe name="survey123webform" width="500" height="400" frameborder="0" marginheight="0" marginwidth="0" title="DiscoverLocal" src="https://survey123.arcgis.com/share/16f8e266ef6b421fb8c2537c5941b2f9" allow="geolocation https://survey123.arcgis.com; camera https://survey123.arcgis.com"></iframe>
    </div>
  
    <script>
      // Toggle Search Widget
      document.getElementById('toggleSearch').addEventListener('click', function() {
          var searchWidgetDiv = document.getElementById('searchWidgetDiv');
          if (searchWidgetDiv.style.display === 'none') {
              searchWidgetDiv.style.display = 'block';
          } else {
              searchWidgetDiv.style.display = 'none';
          }
      });
  
      // Toggle Survey123 Form
      document.getElementById('addRecord').addEventListener('click', function() {
          var surveyContainer = document.getElementById('surveyContainer');
          if (surveyContainer.style.display === 'none') {
              surveyContainer.style.display = 'block';
          } else {
              surveyContainer.style.display = 'none';
          }
      });
  
      // Adjust iframe height based on content
      var survey123webform = document.getElementsByName('survey123webform')[0];
      window.addEventListener("message", e => {
          if (e.data) {
              var t = JSON.parse(e.data);
              ["survey123:webform:formLoaded", "survey123:onFormLoaded"].includes(t.event) && t.contentHeight && (survey123webform.parentNode.style.height = t.contentHeight + "px") && (survey123webform.parentNode.style["padding-bottom"] = "unset");
          }
      });
    </script>
  </body>
  </html>